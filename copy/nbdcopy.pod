=head1 NAME

nbdcopy - copy to and from an NBD server

=head1 SYNOPSIS

 nbdcopy [-p] [--synchronous] SOURCE DESTINATION

 SOURCE, DESTINATION := - | FILE | DEVICE | NBD-URI

 nbdcopy --help

 nbdcopy --version

=head1 EXAMPLES

=head2 nbdcopy nbd://example.com local.img

This copies everything from the NBD server at C<example.com> to a
local file called F<local.img>.

=head2 nbdcopy nbd://example.com - | file -

This streams the first part of the disk on the NBD server at
C<example.com> into the L<file(1)> command.  Note here that C<-> means
to stream to stdout (and therefore into the pipe to the file command).

=head2 nbdcopy -p /dev/sdX nbd://example.com

Copy the full local hard disk C</dev/sdX> to the NBD server at
C<example.com>.  Because of the I<-p> option this will print a
progress bar.

=head2 cat disk1 disk2 | nbdcopy - "nbd+unix:///?socket=/tmp/unixsock"

Concatenate two disk images and stream it to the NBD server listening
on the Unix domain socket F</tmp/unixsock>.

=head2 nbdcopy nbd://server1 nbd://server2

Copy a full disk from one NBD server to another.

=head1 DESCRIPTION

nbdcopy copies to and from an NBD server.  It can upload a local file
to an NBD server, or download the contents of an NBD server to a local
file, device or stdin/stdout.  It can also copy between NBD servers.

The local file can be a file, a block device (eg. C</dev/cdrom>), or
C<-> which means stream in from stdin or stream out to stdout.  The
NBD server is specified using an NBD URI (like C<nbd://localhost>).
The NBD server can be local or remote, and encryption can be used if
libnbd was built with encryption support.

For more complex copying operations including converting between disk
formats use C<qemu-img convert>, see L<qemu-img(1)>.

=head1 OPTIONS

=over 4

=item B<--help>

Display brief command line help and exit.

=item B<-p>

=item B<--progress>

Display a progress bar.

=item B<--synchronous>

Force synchronous copying using the L<libnbd(3)> synchronous ("high
level") API.  This is slow but may be necessary for some broken NBD
servers which cannot handle multiple requests in flight.  This mode is
also used when streaming to and from stdio, pipes and sockets.

=item B<-V>

=item B<--version>

Display the package name and version and exit.

=back

=head1 SEE ALSO

L<libnbd(3)>,
L<nbdfuse(1)>,
L<nbdinfo(1)>,
L<nbdsh(1)>,
L<qemu-img(1)>.

=head1 AUTHORS

Richard W.M. Jones

=head1 COPYRIGHT

Copyright (C) 2020 Red Hat Inc.
